<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta property="og:type" content="website"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png"/><link rel="manifest" href="/assets/favicon/site.webmanifest"/><title>Deserializing JSON - tzyl</title><meta name="robots" content="index,follow"/><meta name="description" content="Loading data stored in JSON with TypeScript, Python, Java and Go"/><meta property="og:title" content="Deserializing JSON - tzyl"/><meta property="og:description" content="Loading data stored in JSON with TypeScript, Python, Java and Go"/><meta property="og:image" content="https://tzyl.dev/_next/static/media/deserializing-json@2x.642c37f3.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css" integrity="sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs" crossorigin="anonymous"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/vs2015.min.css" integrity="sha256-Pi771++jBrwgeHVYGOa1sjN8idXlrrYSKQVI7+JA54k=" crossorigin="anonymous"/><meta name="next-head-count" content="15"/><link rel="preload" href="/_next/static/css/4ad21499c30e2b78.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/4ad21499c30e2b78.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/8a49eceef60c74a6.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/8a49eceef60c74a6.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-8fa1640cc84ba8fe.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-fda0a023b274c574.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-5eadc1f251ff66c8.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-d5c5c666efa9c6b4.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/2-b73848b1def35d0a.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/73-b9dc35ca547b1bd7.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/249-d81a8f7f5c94af82.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-90750821cb9c8d0a.js" defer="" crossorigin=""></script><script src="/_next/static/GsZxPt-1H7wdCO3DxNgQU/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/GsZxPt-1H7wdCO3DxNgQU/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div class="mx-auto flex min-h-screen max-w-screen-lg flex-col px-5 text-gray-800"><nav class="flex flex-wrap items-center pt-8 pb-8"><div class="flex items-center"><a class="mr-2 font-bold" href="/">tzyl</a><a href="https://github.com/tzyl" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mx-1 hover:text-green-300 transition-all duration-100" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://www.linkedin.com/in/timothyleung95" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mx-1 hover:text-green-300 transition-all duration-100" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="mailto:me@tzyl.dev" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mx-1 hover:text-green-300 transition-all duration-100" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><title>Email</title><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a></div><div class="ml-auto flex flex-row items-center"><a class="inline-flex px-3 py-2 font-bold transition-all duration-100 hover:text-green-300" href="/">Home</a><a class="inline-flex px-3 py-2 font-bold transition-all duration-100 hover:text-green-300 underline decoration-4 underline-offset-8" href="/blog/">Blog</a></div></nav><main class="flex-grow"><div class="container mx-auto"><article><h1 class="mb-12 text-center text-5xl font-bold md:text-left md:text-6xl lg:text-7xl">Deserializing JSON</h1><div class="mb-6 text-lg"><time dateTime="2024-01-06T12:00:00.000Z">January	6, 2024</time></div><div class="mb-8 md:mb-16"><img class="shadow" alt="Cover Image for Deserializing JSON" src="/_next/static/media/deserializing-json@1x.69f47c66.png" srcSet="/_next/static/media/deserializing-json@1x.69f47c66.png 1x,/_next/static/media/deserializing-json@2x.642c37f3.png 2x" width="512" height="256"/></div><div class="markdown-styles_markdown__JPpO_ mb-8"><h2>Intro</h2><p>A common workflow when writing software is to take data received from an
external source such as a network request to an API or a file and deserialize it
into an in memory object. The reverse process is also true of serializing an in
memory object to transfer over the network or to persist into a file. The most
widespread data format for this is <a href="https://www.json.org/" target="_blank" rel="nofollow noopener noreferrer">JSON</a> due to its
simplicity and ability to inspect its human readable contents.</p><p>We&#x27;ll show how to interact with JSON data with TypeScript, Python, Java and Go
and make some observations along the way. More specifically we&#x27;ll focus on
deserialization using the standard library where possible to keep code snippets
pure and simple although in production you may prefer other libraries for
example to construct HTTP requests.</p><p>Throughout this post we&#x27;ll use the fake API from
<a href="https://jsonplaceholder.typicode.com/" target="_blank" rel="nofollow noopener noreferrer">JSONPlaceholder</a> as an example. The
schema of the JSON todo data loaded from
<code>https://jsonplaceholder.typicode.com/todos/1</code> looks as follows:</p><pre><code class="hljs language-json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">&quot;userId&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;delectus aut autem&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;completed&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
<span class="hljs-punctuation">}</span>
</code></pre><h2>Untyped deserialization</h2><p>To start with let&#x27;s take a look at loading JSON data in an untyped way. This
might be useful in quick one off scripts or dynamic situations where the exact
schema of the data may not be known up front.</p><h3>TypeScript</h3><p>Given that all JSON is valid as a JavaScript expression (hence the name
JavaScript Object Notation) it&#x27;s unsurprising that working with JSON is
straightforward. When using the Fetch API,
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/json" target="_blank" rel="nofollow noopener noreferrer"><code>Response.json()</code></a>
resolves JSON in a response body to a JavaScript object. Alternatively,
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse" target="_blank" rel="nofollow noopener noreferrer"><code>JSON.parse()</code></a>
may be used when working with string content from a loaded file.</p><p>Note that in JavaScript the <code>number</code> type is a double precision floating point
number whereas the JSON spec does not require a specific precision. In practice,
for interoperability it may be expected that double precision floating point
numbers are used in JSON or strings are used instead to avoid ambiguity over
loss of precision of large numbers.</p><pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>);
<span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>(); <span class="hljs-comment">// any</span>
<span class="hljs-keyword">const</span> id = data.<span class="hljs-property">id</span>; <span class="hljs-comment">// any</span>
<span class="hljs-keyword">const</span> userId = data.<span class="hljs-property">userId</span>; <span class="hljs-comment">// any</span>
<span class="hljs-keyword">const</span> title = data.<span class="hljs-property">title</span>; <span class="hljs-comment">// any</span>
<span class="hljs-keyword">const</span> completed = data.<span class="hljs-property">completed</span>; <span class="hljs-comment">// any</span>
<span class="hljs-keyword">const</span> doesNotExist = data.<span class="hljs-property">doesNotExist</span>; <span class="hljs-comment">// any, undefined at runtime!</span>
</code></pre><h3>Python</h3><p>The Python dictionary is the analog to the JavaScript object for working with
key value data. Handling untyped data is natural as a dynamically typed language
although the addition of static type checking is possible on top through
<a href="https://mypy.readthedocs.io/en/stable/" target="_blank" rel="nofollow noopener noreferrer">mypy</a> and type hints similar to the
addition of TypeScript on top of JavaScript. We can use
<a href="https://docs.python.org/3/library/json.html#json.loads" target="_blank" rel="nofollow noopener noreferrer"><code>json.loads()</code></a> to
parse a string containing JSON data into a dictionary.</p><p>Note that JSON numbers will automatically be deserialized to either <code>int</code> or
<code>float</code> Python types depending on whether it can be represented as an integer.</p><pre><code class="hljs language-python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> urllib.request

response = urllib.request.urlopen(<span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>)
data = json.loads(response.read().decode(<span class="hljs-string">&quot;utf-8&quot;</span>))  <span class="hljs-comment"># Any</span>
<span class="hljs-built_in">id</span> = data[<span class="hljs-string">&quot;id&quot;</span>]  <span class="hljs-comment"># Any</span>
user_id = data[<span class="hljs-string">&quot;userId&quot;</span>]  <span class="hljs-comment"># Any</span>
title = data[<span class="hljs-string">&quot;title&quot;</span>]  <span class="hljs-comment"># Any</span>
completed = data[<span class="hljs-string">&quot;completed&quot;</span>]  <span class="hljs-comment"># Any</span>
does_not_exist = data[<span class="hljs-string">&quot;doesNotExist&quot;</span>]  <span class="hljs-comment"># Any, KeyError at runtime!</span>
</code></pre><h3>Java</h3><p>This example uses the standard HTTP client API introduced in Java 11 together
with <a href="https://github.com/FasterXML/jackson" target="_blank" rel="nofollow noopener noreferrer">Jackson</a> one of the de facto
libraries for handling JSON in Java. We receive a <code>JsonNode</code> from the
<code>ObjectMapper.readTree()</code> method allowing us to access arbitrary JSON properties
in the tree structure.</p><p>Note that when calling methods such as <code>JsonNode.asInt()</code> to coerce the
underlying value to an <code>int</code> other JSON values other than numbers such as
booleans and strings may be accepted. If the value cannot be coerced to an <code>int</code>
the default value of the type will be returned which would be 0 for ints.</p><pre><code class="hljs language-java"><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.JsonNode;
<span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.net.URI;
<span class="hljs-keyword">import</span> java.net.URISyntaxException;
<span class="hljs-keyword">import</span> java.net.http.HttpClient;
<span class="hljs-keyword">import</span> java.net.http.HttpRequest;
<span class="hljs-keyword">import</span> java.net.http.HttpResponse;
<span class="hljs-keyword">import</span> java.net.http.HttpResponse.BodyHandlers;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] _args)</span> <span class="hljs-keyword">throws</span> URISyntaxException, IOException, InterruptedException {
        <span class="hljs-type">HttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> HttpClient.newHttpClient();
        <span class="hljs-type">HttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpRequest.newBuilder()
                .uri(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URI</span>(<span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>))
                .GET()
                .build();
        HttpResponse&lt;InputStream&gt; response = client.send(request, BodyHandlers.ofInputStream());
        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
        <span class="hljs-type">JsonNode</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> mapper.readTree(response.body());
        <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> data.get(<span class="hljs-string">&quot;id&quot;</span>).asInt();
        <span class="hljs-type">int</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> data.get(<span class="hljs-string">&quot;userId&quot;</span>).asInt();
        <span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> data.get(<span class="hljs-string">&quot;title&quot;</span>).asText();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">completed</span> <span class="hljs-operator">=</span> data.get(<span class="hljs-string">&quot;completed&quot;</span>).asBoolean();
        <span class="hljs-type">JsonNode</span> <span class="hljs-variable">doesNotExist</span> <span class="hljs-operator">=</span> data.get(<span class="hljs-string">&quot;doesNotExist&quot;</span>); <span class="hljs-comment">// null at runtime!</span>
    }
}
</code></pre><h3>Go</h3><p>The empty interface <code>interface{}</code> in Go allows working with data of an unknown
type. If we use <a href="https://pkg.go.dev/encoding/json#Unmarshal" target="_blank" rel="nofollow noopener noreferrer">json.Unmarshal()</a>
on a pointer to a <code>map[string]interface{}</code> value we&#x27;ll receive the deserialized
JSON object according to the specified types:</p><pre><code>bool, for JSON booleans
float64, for JSON numbers
string, for JSON strings
[]interface{}, for JSON arrays
map[string]interface{}, for JSON objects
nil for JSON null
</code></pre><p>Note that numbers are always deserialized to <code>float64</code> when an interface value
is used so an explicit type conversion to <code>int</code> is needed if desired.</p><pre><code class="hljs language-go"><span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;encoding/json&quot;</span>
    <span class="hljs-string">&quot;io&quot;</span>
    <span class="hljs-string">&quot;net/http&quot;</span>
)

response, err := http.Get(<span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-built_in">panic</span>(err)
}
<span class="hljs-keyword">defer</span> response.Body.Close()

body, err := io.ReadAll(response.Body)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-built_in">panic</span>(err)
}

<span class="hljs-keyword">var</span> data <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-keyword">interface</span>{}
err = json.Unmarshal(body, &amp;data)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-built_in">panic</span>(err)
}

id := data[<span class="hljs-string">&quot;id&quot;</span>].(<span class="hljs-type">float64</span>)            <span class="hljs-comment">// float64</span>
userId := data[<span class="hljs-string">&quot;userId&quot;</span>].(<span class="hljs-type">float64</span>)    <span class="hljs-comment">// float64</span>
title := data[<span class="hljs-string">&quot;title&quot;</span>].(<span class="hljs-type">string</span>)       <span class="hljs-comment">// string</span>
completed := data[<span class="hljs-string">&quot;completed&quot;</span>].(<span class="hljs-type">bool</span>) <span class="hljs-comment">// bool</span>
doesNotExist := data[<span class="hljs-string">&quot;doesNotExist&quot;</span>]  <span class="hljs-comment">// interface{}, nil at runtime!</span>
</code></pre><h2>Typed deserialization</h2><p>Now let&#x27;s consider how to deserialize JSON into typed objects allowing our code
to operate in a safer way and automatically catch mistakes such as a typo
accessing wrong field names.</p><h3>TypeScript</h3><p>An explicit type annotation gives a hint to the TypeScript compiler on the type
we want it to treat the object as. Now the compiler knows what fields exist and
what types they should be it can catch errors on incorrect access (according to
the types it was told).</p><p>Note that this is compile time only and does not change the runtime JavaScript
code once compiled with any extra validation or type conversions - the exact
same JavaScript object is still used which may error at runtime if typed
incorrectly or subsequently mutated.</p><pre><code class="hljs language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Todo</span> {
  <span class="hljs-attr">userId</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">completed</span>: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>);
<span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Todo</span> = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
<span class="hljs-keyword">const</span> id = data.<span class="hljs-property">id</span>; <span class="hljs-comment">// number</span>
<span class="hljs-keyword">const</span> userId = data.<span class="hljs-property">userId</span>; <span class="hljs-comment">// number</span>
<span class="hljs-keyword">const</span> title = data.<span class="hljs-property">title</span>; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">const</span> completed = data.<span class="hljs-property">completed</span>; <span class="hljs-comment">// boolean</span>
<span class="hljs-keyword">const</span> doesNotExist = data.<span class="hljs-property">doesNotExist</span>; <span class="hljs-comment">// compile error!</span>
</code></pre><h3>Python</h3><p>The <a href="https://mypy.readthedocs.io/en/stable/typed_dict.html" target="_blank" rel="nofollow noopener noreferrer"><code>TypedDict</code></a> type
allows us to perform a very similar type annotation. When using
<a href="https://mypy.readthedocs.io/en/stable/" target="_blank" rel="nofollow noopener noreferrer">mypy</a> to check static types we achieve
a similar level of protection at lint time.</p><p>Note that this is lint time only and again does not affect the executed code at
runtime.</p><pre><code class="hljs language-python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> urllib.request
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict


<span class="hljs-keyword">class</span> <span class="hljs-title class_">Todo</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    userId: <span class="hljs-built_in">int</span>
    title: <span class="hljs-built_in">str</span>
    completed: <span class="hljs-built_in">bool</span>


response = urllib.request.urlopen(<span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>)
data: Todo = json.loads(response.read().decode(<span class="hljs-string">&quot;utf-8&quot;</span>))  <span class="hljs-comment"># Todo</span>
<span class="hljs-built_in">id</span> = data[<span class="hljs-string">&quot;id&quot;</span>]  <span class="hljs-comment"># int</span>
user_id = data[<span class="hljs-string">&quot;userId&quot;</span>]  <span class="hljs-comment"># int</span>
title = data[<span class="hljs-string">&quot;title&quot;</span>]  <span class="hljs-comment"># str</span>
completed = data[<span class="hljs-string">&quot;completed&quot;</span>]  <span class="hljs-comment"># bool</span>
does_not_exist = data[<span class="hljs-string">&quot;doesNotExist&quot;</span>]  <span class="hljs-comment"># typeddict-item error at lint time!</span>
</code></pre><h3>Java</h3><p>The first step is to define a class to deserialize data into. Here we define a
simple <code>Todo</code> plain old Java object (POJO) with standard getters and setters.
Jackson automatically works with these types of classes out of the box by
matching the field names based on the method names. Jackson annotations can
customise the deserialization behaviour such as <code>@JsonProperty</code> to remap field
names.</p><p>Note that this does change the runtime code. It creates new <code>Todo</code> objects
rather than <code>JsonNode</code> objects and by default, Jackson object mappers fail on
encountering unknown properties during deserialization.</p><pre><code class="hljs language-java"><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.net.URI;
<span class="hljs-keyword">import</span> java.net.URISyntaxException;
<span class="hljs-keyword">import</span> java.net.http.HttpClient;
<span class="hljs-keyword">import</span> java.net.http.HttpRequest;
<span class="hljs-keyword">import</span> java.net.http.HttpResponse;
<span class="hljs-keyword">import</span> java.net.http.HttpResponse.BodyHandlers;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] _args)</span> <span class="hljs-keyword">throws</span> URISyntaxException, IOException, InterruptedException {
        <span class="hljs-type">HttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> HttpClient.newHttpClient();
        <span class="hljs-type">HttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpRequest.newBuilder()
                .uri(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URI</span>(<span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>))
                .GET()
                .build();
        HttpResponse&lt;InputStream&gt; response = client.send(request, BodyHandlers.ofInputStream());
        <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">mapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
        <span class="hljs-type">Todo</span> <span class="hljs-variable">todo</span> <span class="hljs-operator">=</span> mapper.readValue(response.body(), Todo.class);
        <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> todo.getId();
        <span class="hljs-type">int</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> todo.getUserId();
        <span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> todo.getTitle();
        <span class="hljs-type">boolean</span> <span class="hljs-variable">completed</span> <span class="hljs-operator">=</span> todo.getCompleted();
        <span class="hljs-type">JsonNode</span> <span class="hljs-variable">doesNotExist</span> <span class="hljs-operator">=</span> todo.getDoesNotExist(); <span class="hljs-comment">// compile error!</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Todo</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> userId;
        <span class="hljs-keyword">private</span> String title;
        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> completed;

        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> id;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(<span class="hljs-type">int</span> id)</span> {
            <span class="hljs-built_in">this</span>.id = id;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getUserId</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> userId;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setUserId</span><span class="hljs-params">(<span class="hljs-type">int</span> userId)</span> {
            <span class="hljs-built_in">this</span>.userId = userId;
        }

        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getTitle</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> title;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTitle</span><span class="hljs-params">(String title)</span> {
            <span class="hljs-built_in">this</span>.title = title;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">getCompleted</span><span class="hljs-params">()</span> {
            <span class="hljs-keyword">return</span> completed;
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCompleted</span><span class="hljs-params">(<span class="hljs-type">boolean</span> completed)</span> {
            <span class="hljs-built_in">this</span>.completed = completed;
        }
    }
}
</code></pre><h3>Go</h3><p>Instead of deserializing into the empty interface we can define and deserialize
into a <code>struct</code>. The field names are matched to <code>struct</code> field names accepting
case-insensitive matches. Alternative field names may be used by adding extra
metadata in <a href="https://pkg.go.dev/encoding/json#Marshal" target="_blank" rel="nofollow noopener noreferrer">struct tags</a> such as
<code>Field int `json:&quot;myName&quot;`</code></p><p>Note that similar to Java this does have an effect at runtime for example
choosing to deserialize numbers as ints rather than <code>float64</code>.</p><pre><code class="hljs language-go"><span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;encoding/json&quot;</span>
    <span class="hljs-string">&quot;io&quot;</span>
    <span class="hljs-string">&quot;net/http&quot;</span>
)

<span class="hljs-keyword">type</span> Todo <span class="hljs-keyword">struct</span> {
    Id        <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;id&quot;`</span>
    UserId    <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;userId&quot;`</span>
    Title     <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;title&quot;`</span>
    Completed <span class="hljs-type">bool</span>   <span class="hljs-string">`json:&quot;completed&quot;`</span>
}

response, err := http.Get(<span class="hljs-string">&quot;https://jsonplaceholder.typicode.com/todos/1&quot;</span>)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-built_in">panic</span>(err)
}
<span class="hljs-keyword">defer</span> response.Body.Close()

body, err := io.ReadAll(response.Body)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-built_in">panic</span>(err)
}

<span class="hljs-keyword">var</span> data Todo
err = json.Unmarshal(body, &amp;data)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-built_in">panic</span>(err)
}

id := data.Id                     <span class="hljs-comment">// int</span>
userId := data.UserId             <span class="hljs-comment">// int</span>
title := data.Title               <span class="hljs-comment">// string</span>
completed := data.Completed       <span class="hljs-comment">// bool</span>
doesNotExist := data.DoesNotExist <span class="hljs-comment">// compile error!</span>
</code></pre><h2>Data constraints</h2><p>Going further than simply parsing we may want to enforce data constraints
relevant to the objects in our data model.</p><p>Some of these may be inherent to the deserialization itself such as:</p><ul><li>Treat missing or null values for array fields as an empty array</li><li>Remove null elements inside arrays</li><li>Fail on extra fields sent that we do not recognise</li></ul><p>This category of data constraint can often be tuned for example with Jackson&#x27;s
<a href="https://github.com/FasterXML/jackson-databind/wiki/Deserialization-Features" target="_blank" rel="nofollow noopener noreferrer">DeserializationFeature</a>.</p><p>Others may be relevant to business logic or necessary for the object as a whole
to make sense for example invariants between fields:</p><ul><li>Max length of string for a title</li><li>Non-negative integer value for a page size</li><li>Value matches expected format like a book ISBN number</li></ul><p>For TypeScript and Python, these will obviously require extra code changes at
runtime and will make the deserialization perform closer to the given Java and
Go examples. Ideas to explore in this direction are:</p><ul><li>Typescript<ul><li><a href="https://zod.dev/" target="_blank" rel="nofollow noopener noreferrer"><code>zod</code></a></li></ul></li><li>Python<ul><li><a href="https://docs.python.org/3/library/dataclasses.html" target="_blank" rel="nofollow noopener noreferrer"><code>dataclasses</code></a></li><li><a href="https://docs.pydantic.dev/latest/" target="_blank" rel="nofollow noopener noreferrer"><code>pydantic</code></a></li><li><a href="https://www.attrs.org/" target="_blank" rel="nofollow noopener noreferrer"><code>attrs</code></a> and <a href="https://catt.rs/" target="_blank" rel="nofollow noopener noreferrer"><code>cattrs</code></a></li></ul></li><li>Java<ul><li><a href="https://beanvalidation.org/2.0-jsr380/" target="_blank" rel="nofollow noopener noreferrer">JSR 380</a> and the
<code>jakarta.validation.constraints</code> annotations</li><li><a href="https://immutables.github.io/" target="_blank" rel="nofollow noopener noreferrer">Immutables</a> with precondition check methods</li></ul></li><li>Go<ul><li><a href="https://github.com/go-playground/validator" target="_blank" rel="nofollow noopener noreferrer">go-playground/validator</a></li></ul></li></ul><p><a href="https://json-schema.org/" target="_blank" rel="nofollow noopener noreferrer">JSON Schema</a> also exists as a standard for defining a
schema for JSON data with validator implementations for all of the popular
programming languages.</p><h3>Conclusion</h3><p>One of the main purposes of JSON is for interoperability between different
software boundaries. It&#x27;s interesting to take a fundamental task such as
deserializing JSON and compare side by side how different languages and their
libraries approach it.</p><p>Notably, Java stands out as requiring an external library to perform basic
parsing and potentially even further libraries for cutting down boilerplate code
through codegen of standard getter/setters. I&#x27;m personally a fan of the mix of
conciseness and out of the box safety provided by Go in this case without the
need for a lot of work to setup additional tools.</p></div><div class="py-8"><a class="inline-flex items-center font-bold transition-all duration-100 hover:text-green-300" href="/blog/"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>Back to all posts</a></div></article></div></main><footer class="py-8">Tim Leung 2024</footer></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"post":{"slug":"deserializing-json","title":"Deserializing JSON","excerpt":"Loading data stored in JSON with TypeScript, Python, Java and Go","date":"2024-01-06T12:00:00.000Z","coverImage":"blog/deserializing-json/deserializing-json.png","ogImage":"blog/deserializing-json/deserializing-json.png","content":"\n## Intro\n\nA common workflow when writing software is to take data received from an\nexternal source such as a network request to an API or a file and deserialize it\ninto an in memory object. The reverse process is also true of serializing an in\nmemory object to transfer over the network or to persist into a file. The most\nwidespread data format for this is [JSON](https://www.json.org/) due to its\nsimplicity and ability to inspect its human readable contents.\n\nWe'll show how to interact with JSON data with TypeScript, Python, Java and Go\nand make some observations along the way. More specifically we'll focus on\ndeserialization using the standard library where possible to keep code snippets\npure and simple although in production you may prefer other libraries for\nexample to construct HTTP requests.\n\nThroughout this post we'll use the fake API from\n[JSONPlaceholder](https://jsonplaceholder.typicode.com/) as an example. The\nschema of the JSON todo data loaded from\n`https://jsonplaceholder.typicode.com/todos/1` looks as follows:\n\n```json\n{\n  \"userId\": 1,\n  \"id\": 1,\n  \"title\": \"delectus aut autem\",\n  \"completed\": false\n}\n```\n\n## Untyped deserialization\n\nTo start with let's take a look at loading JSON data in an untyped way. This\nmight be useful in quick one off scripts or dynamic situations where the exact\nschema of the data may not be known up front.\n\n### TypeScript\n\nGiven that all JSON is valid as a JavaScript expression (hence the name\nJavaScript Object Notation) it's unsurprising that working with JSON is\nstraightforward. When using the Fetch API,\n[`Response.json()`](https://developer.mozilla.org/en-US/docs/Web/API/Response/json)\nresolves JSON in a response body to a JavaScript object. Alternatively,\n[`JSON.parse()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse)\nmay be used when working with string content from a loaded file.\n\nNote that in JavaScript the `number` type is a double precision floating point\nnumber whereas the JSON spec does not require a specific precision. In practice,\nfor interoperability it may be expected that double precision floating point\nnumbers are used in JSON or strings are used instead to avoid ambiguity over\nloss of precision of large numbers.\n\n```typescript\nconst response = await fetch(\"https://jsonplaceholder.typicode.com/todos/1\");\nconst data = await response.json(); // any\nconst id = data.id; // any\nconst userId = data.userId; // any\nconst title = data.title; // any\nconst completed = data.completed; // any\nconst doesNotExist = data.doesNotExist; // any, undefined at runtime!\n```\n\n### Python\n\nThe Python dictionary is the analog to the JavaScript object for working with\nkey value data. Handling untyped data is natural as a dynamically typed language\nalthough the addition of static type checking is possible on top through\n[mypy](https://mypy.readthedocs.io/en/stable/) and type hints similar to the\naddition of TypeScript on top of JavaScript. We can use\n[`json.loads()`](https://docs.python.org/3/library/json.html#json.loads) to\nparse a string containing JSON data into a dictionary.\n\nNote that JSON numbers will automatically be deserialized to either `int` or\n`float` Python types depending on whether it can be represented as an integer.\n\n```python\nimport json\nimport urllib.request\n\nresponse = urllib.request.urlopen(\"https://jsonplaceholder.typicode.com/todos/1\")\ndata = json.loads(response.read().decode(\"utf-8\"))  # Any\nid = data[\"id\"]  # Any\nuser_id = data[\"userId\"]  # Any\ntitle = data[\"title\"]  # Any\ncompleted = data[\"completed\"]  # Any\ndoes_not_exist = data[\"doesNotExist\"]  # Any, KeyError at runtime!\n```\n\n### Java\n\nThis example uses the standard HTTP client API introduced in Java 11 together\nwith [Jackson](https://github.com/FasterXML/jackson) one of the de facto\nlibraries for handling JSON in Java. We receive a `JsonNode` from the\n`ObjectMapper.readTree()` method allowing us to access arbitrary JSON properties\nin the tree structure.\n\nNote that when calling methods such as `JsonNode.asInt()` to coerce the\nunderlying value to an `int` other JSON values other than numbers such as\nbooleans and strings may be accepted. If the value cannot be coerced to an `int`\nthe default value of the type will be returned which would be 0 for ints.\n\n```java\nimport com.fasterxml.jackson.databind.JsonNode;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.net.URI;\nimport java.net.URISyntaxException;\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\nimport java.net.http.HttpResponse.BodyHandlers;\n\npublic class JavaExample {\n    public static void main(String[] _args) throws URISyntaxException, IOException, InterruptedException {\n        HttpClient client = HttpClient.newHttpClient();\n        HttpRequest request = HttpRequest.newBuilder()\n                .uri(new URI(\"https://jsonplaceholder.typicode.com/todos/1\"))\n                .GET()\n                .build();\n        HttpResponse\u003cInputStream\u003e response = client.send(request, BodyHandlers.ofInputStream());\n        ObjectMapper mapper = new ObjectMapper();\n        JsonNode data = mapper.readTree(response.body());\n        int id = data.get(\"id\").asInt();\n        int userId = data.get(\"userId\").asInt();\n        String title = data.get(\"title\").asText();\n        boolean completed = data.get(\"completed\").asBoolean();\n        JsonNode doesNotExist = data.get(\"doesNotExist\"); // null at runtime!\n    }\n}\n```\n\n### Go\n\nThe empty interface `interface{}` in Go allows working with data of an unknown\ntype. If we use [json.Unmarshal()](https://pkg.go.dev/encoding/json#Unmarshal)\non a pointer to a `map[string]interface{}` value we'll receive the deserialized\nJSON object according to the specified types:\n\n```\nbool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays\nmap[string]interface{}, for JSON objects\nnil for JSON null\n```\n\nNote that numbers are always deserialized to `float64` when an interface value\nis used so an explicit type conversion to `int` is needed if desired.\n\n```go\nimport (\n\t\"encoding/json\"\n\t\"io\"\n\t\"net/http\"\n)\n\nresponse, err := http.Get(\"https://jsonplaceholder.typicode.com/todos/1\")\nif err != nil {\n\tpanic(err)\n}\ndefer response.Body.Close()\n\nbody, err := io.ReadAll(response.Body)\nif err != nil {\n\tpanic(err)\n}\n\nvar data map[string]interface{}\nerr = json.Unmarshal(body, \u0026data)\nif err != nil {\n\tpanic(err)\n}\n\nid := data[\"id\"].(float64)            // float64\nuserId := data[\"userId\"].(float64)    // float64\ntitle := data[\"title\"].(string)       // string\ncompleted := data[\"completed\"].(bool) // bool\ndoesNotExist := data[\"doesNotExist\"]  // interface{}, nil at runtime!\n```\n\n## Typed deserialization\n\nNow let's consider how to deserialize JSON into typed objects allowing our code\nto operate in a safer way and automatically catch mistakes such as a typo\naccessing wrong field names.\n\n### TypeScript\n\nAn explicit type annotation gives a hint to the TypeScript compiler on the type\nwe want it to treat the object as. Now the compiler knows what fields exist and\nwhat types they should be it can catch errors on incorrect access (according to\nthe types it was told).\n\nNote that this is compile time only and does not change the runtime JavaScript\ncode once compiled with any extra validation or type conversions - the exact\nsame JavaScript object is still used which may error at runtime if typed\nincorrectly or subsequently mutated.\n\n```typescript\ninterface Todo {\n  userId: number;\n  id: number;\n  title: string;\n  completed: boolean;\n}\n\nconst response = await fetch(\"https://jsonplaceholder.typicode.com/todos/1\");\nconst data: Todo = await response.json();\nconst id = data.id; // number\nconst userId = data.userId; // number\nconst title = data.title; // string\nconst completed = data.completed; // boolean\nconst doesNotExist = data.doesNotExist; // compile error!\n```\n\n### Python\n\nThe [`TypedDict`](https://mypy.readthedocs.io/en/stable/typed_dict.html) type\nallows us to perform a very similar type annotation. When using\n[mypy](https://mypy.readthedocs.io/en/stable/) to check static types we achieve\na similar level of protection at lint time.\n\nNote that this is lint time only and again does not affect the executed code at\nruntime.\n\n```python\nimport json\nimport urllib.request\nfrom typing import TypedDict\n\n\nclass Todo(TypedDict):\n    id: int\n    userId: int\n    title: str\n    completed: bool\n\n\nresponse = urllib.request.urlopen(\"https://jsonplaceholder.typicode.com/todos/1\")\ndata: Todo = json.loads(response.read().decode(\"utf-8\"))  # Todo\nid = data[\"id\"]  # int\nuser_id = data[\"userId\"]  # int\ntitle = data[\"title\"]  # str\ncompleted = data[\"completed\"]  # bool\ndoes_not_exist = data[\"doesNotExist\"]  # typeddict-item error at lint time!\n```\n\n### Java\n\nThe first step is to define a class to deserialize data into. Here we define a\nsimple `Todo` plain old Java object (POJO) with standard getters and setters.\nJackson automatically works with these types of classes out of the box by\nmatching the field names based on the method names. Jackson annotations can\ncustomise the deserialization behaviour such as `@JsonProperty` to remap field\nnames.\n\nNote that this does change the runtime code. It creates new `Todo` objects\nrather than `JsonNode` objects and by default, Jackson object mappers fail on\nencountering unknown properties during deserialization.\n\n```java\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.net.URI;\nimport java.net.URISyntaxException;\nimport java.net.http.HttpClient;\nimport java.net.http.HttpRequest;\nimport java.net.http.HttpResponse;\nimport java.net.http.HttpResponse.BodyHandlers;\n\npublic class JavaExample {\n    public static void main(String[] _args) throws URISyntaxException, IOException, InterruptedException {\n        HttpClient client = HttpClient.newHttpClient();\n        HttpRequest request = HttpRequest.newBuilder()\n                .uri(new URI(\"https://jsonplaceholder.typicode.com/todos/1\"))\n                .GET()\n                .build();\n        HttpResponse\u003cInputStream\u003e response = client.send(request, BodyHandlers.ofInputStream());\n        ObjectMapper mapper = new ObjectMapper();\n        Todo todo = mapper.readValue(response.body(), Todo.class);\n        int id = todo.getId();\n        int userId = todo.getUserId();\n        String title = todo.getTitle();\n        boolean completed = todo.getCompleted();\n        JsonNode doesNotExist = todo.getDoesNotExist(); // compile error!\n    }\n\n    private static final class Todo {\n        private int id;\n        private int userId;\n        private String title;\n        private boolean completed;\n\n        public int getId() {\n            return id;\n        }\n\n        public void setId(int id) {\n            this.id = id;\n        }\n\n        public int getUserId() {\n            return userId;\n        }\n\n        public void setUserId(int userId) {\n            this.userId = userId;\n        }\n\n        public String getTitle() {\n            return title;\n        }\n\n        public void setTitle(String title) {\n            this.title = title;\n        }\n\n        public boolean getCompleted() {\n            return completed;\n        }\n\n        public void setCompleted(boolean completed) {\n            this.completed = completed;\n        }\n    }\n}\n```\n\n### Go\n\nInstead of deserializing into the empty interface we can define and deserialize\ninto a `struct`. The field names are matched to `struct` field names accepting\ncase-insensitive matches. Alternative field names may be used by adding extra\nmetadata in [struct tags](https://pkg.go.dev/encoding/json#Marshal) such as\n`` Field int `json:\"myName\"` ``\n\nNote that similar to Java this does have an effect at runtime for example\nchoosing to deserialize numbers as ints rather than `float64`.\n\n```go\nimport (\n\t\"encoding/json\"\n\t\"io\"\n\t\"net/http\"\n)\n\ntype Todo struct {\n\tId        int    `json:\"id\"`\n\tUserId    int    `json:\"userId\"`\n\tTitle     string `json:\"title\"`\n\tCompleted bool   `json:\"completed\"`\n}\n\nresponse, err := http.Get(\"https://jsonplaceholder.typicode.com/todos/1\")\nif err != nil {\n    panic(err)\n}\ndefer response.Body.Close()\n\nbody, err := io.ReadAll(response.Body)\nif err != nil {\n    panic(err)\n}\n\nvar data Todo\nerr = json.Unmarshal(body, \u0026data)\nif err != nil {\n    panic(err)\n}\n\nid := data.Id                     // int\nuserId := data.UserId             // int\ntitle := data.Title               // string\ncompleted := data.Completed       // bool\ndoesNotExist := data.DoesNotExist // compile error!\n```\n\n## Data constraints\n\nGoing further than simply parsing we may want to enforce data constraints\nrelevant to the objects in our data model.\n\nSome of these may be inherent to the deserialization itself such as:\n\n- Treat missing or null values for array fields as an empty array\n- Remove null elements inside arrays\n- Fail on extra fields sent that we do not recognise\n\nThis category of data constraint can often be tuned for example with Jackson's\n[DeserializationFeature](https://github.com/FasterXML/jackson-databind/wiki/Deserialization-Features).\n\nOthers may be relevant to business logic or necessary for the object as a whole\nto make sense for example invariants between fields:\n\n- Max length of string for a title\n- Non-negative integer value for a page size\n- Value matches expected format like a book ISBN number\n\nFor TypeScript and Python, these will obviously require extra code changes at\nruntime and will make the deserialization perform closer to the given Java and\nGo examples. Ideas to explore in this direction are:\n\n- Typescript\n  - [`zod`](https://zod.dev/)\n- Python\n  - [`dataclasses`](https://docs.python.org/3/library/dataclasses.html)\n  - [`pydantic`](https://docs.pydantic.dev/latest/)\n  - [`attrs`](https://www.attrs.org/) and [`cattrs`](https://catt.rs/)\n- Java\n  - [JSR 380](https://beanvalidation.org/2.0-jsr380/) and the\n    `jakarta.validation.constraints` annotations\n  - [Immutables](https://immutables.github.io/) with precondition check methods\n- Go\n  - [go-playground/validator](https://github.com/go-playground/validator)\n\n[JSON Schema](https://json-schema.org/) also exists as a standard for defining a\nschema for JSON data with validator implementations for all of the popular\nprogramming languages.\n\n### Conclusion\n\nOne of the main purposes of JSON is for interoperability between different\nsoftware boundaries. It's interesting to take a fundamental task such as\ndeserializing JSON and compare side by side how different languages and their\nlibraries approach it.\n\nNotably, Java stands out as requiring an external library to perform basic\nparsing and potentially even further libraries for cutting down boilerplate code\nthrough codegen of standard getter/setters. I'm personally a fan of the mix of\nconciseness and out of the box safety provided by Go in this case without the\nneed for a lot of work to setup additional tools.\n","mdxSource":{"compiledSource":"var i=Object.defineProperty,d=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;var l=(a,s,n)=\u003es in a?i(a,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[s]=n,e=(a,s)=\u003e{for(var n in s||(s={}))o.call(s,n)\u0026\u0026l(a,n,s[n]);if(p)for(var n of p(s))r.call(s,n)\u0026\u0026l(a,n,s[n]);return a},c=(a,s)=\u003ed(a,N(s));var m=(a,s)=\u003e{var n={};for(var t in a)o.call(a,t)\u0026\u0026s.indexOf(t)\u003c0\u0026\u0026(n[t]=a[t]);if(a!=null\u0026\u0026p)for(var t of p(a))s.indexOf(t)\u003c0\u0026\u0026r.call(a,t)\u0026\u0026(n[t]=a[t]);return n};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(n){var t=n,{components:a}=t,s=m(t,[\"components\"]);return mdx(MDXLayout,c(e(e({},layoutProps),s),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h2\",null,\"Intro\"),mdx(\"p\",null,`A common workflow when writing software is to take data received from an\nexternal source such as a network request to an API or a file and deserialize it\ninto an in memory object. The reverse process is also true of serializing an in\nmemory object to transfer over the network or to persist into a file. The most\nwidespread data format for this is `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.json.org/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"JSON\"),` due to its\nsimplicity and ability to inspect its human readable contents.`),mdx(\"p\",null,`We'll show how to interact with JSON data with TypeScript, Python, Java and Go\nand make some observations along the way. More specifically we'll focus on\ndeserialization using the standard library where possible to keep code snippets\npure and simple although in production you may prefer other libraries for\nexample to construct HTTP requests.`),mdx(\"p\",null,`Throughout this post we'll use the fake API from\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://jsonplaceholder.typicode.com/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"JSONPlaceholder\"),` as an example. The\nschema of the JSON todo data loaded from\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"https://jsonplaceholder.typicode.com/todos/1\"),\" looks as follows:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-json\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-punctuation\"}),\"{\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"userId\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"1\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-punctuation\"}),\",\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"id\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-number\"}),\"1\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-punctuation\"}),\",\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"title\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"delectus aut autem\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-punctuation\"}),\",\"),`\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),'\"completed\"'),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-punctuation\"}),\":\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-keyword\"}),\"false\")),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-punctuation\"}),\"}\"),`\n`)),mdx(\"h2\",null,\"Untyped deserialization\"),mdx(\"p\",null,`To start with let's take a look at loading JSON data in an untyped way. This\nmight be useful in quick one off scripts or dynamic situations where the exact\nschema of the data may not be known up front.`),mdx(\"h3\",null,\"TypeScript\"),mdx(\"p\",null,`Given that all JSON is valid as a JavaScript expression (hence the name\nJavaScript Object Notation) it's unsurprising that working with JSON is\nstraightforward. When using the Fetch API,\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://developer.mozilla.org/en-US/docs/Web/API/Response/json\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"Response.json()\")),`\nresolves JSON in a response body to a JavaScript object. Alternatively,\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/parse\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"JSON.parse()\")),`\nmay be used when working with string content from a loaded file.`),mdx(\"p\",null,\"Note that in JavaScript the \",mdx(\"inlineCode\",{parentName:\"p\"},\"number\"),` type is a double precision floating point\nnumber whereas the JSON spec does not require a specific precision. In practice,\nfor interoperability it may be expected that double precision floating point\nnumbers are used in JSON or strings are used instead to avoid ambiguity over\nloss of precision of large numbers.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" response = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"await\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"fetch\"),\"(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"https://jsonplaceholder.typicode.com/todos/1\"'),`);\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" data = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"await\"),\" response.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"json\"),\"(); \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// any\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" id = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"id\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// any\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" userId = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"userId\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// any\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" title = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"title\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// any\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" completed = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"completed\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// any\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" doesNotExist = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"doesNotExist\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// any, undefined at runtime!\"),`\n`)),mdx(\"h3\",null,\"Python\"),mdx(\"p\",null,`The Python dictionary is the analog to the JavaScript object for working with\nkey value data. Handling untyped data is natural as a dynamically typed language\nalthough the addition of static type checking is possible on top through\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://mypy.readthedocs.io/en/stable/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"mypy\"),` and type hints similar to the\naddition of TypeScript on top of JavaScript. We can use\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/json.html#json.loads\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"json.loads()\")),` to\nparse a string containing JSON data into a dictionary.`),mdx(\"p\",null,\"Note that JSON numbers will automatically be deserialized to either \",mdx(\"inlineCode\",{parentName:\"p\"},\"int\"),` or\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"float\"),\" Python types depending on whether it can be represented as an integer.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-python\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` json\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` urllib.request\n\nresponse = urllib.request.urlopen(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"https://jsonplaceholder.typicode.com/todos/1\"'),`)\ndata = json.loads(response.read().decode(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"utf-8\"'),\"))  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# Any\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"id\"),\" = data[\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"id\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# Any\"),`\nuser_id = data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"userId\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# Any\"),`\ntitle = data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"title\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# Any\"),`\ncompleted = data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"completed\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# Any\"),`\ndoes_not_exist = data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"doesNotExist\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# Any, KeyError at runtime!\"),`\n`)),mdx(\"h3\",null,\"Java\"),mdx(\"p\",null,`This example uses the standard HTTP client API introduced in Java 11 together\nwith `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/FasterXML/jackson\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"Jackson\"),` one of the de facto\nlibraries for handling JSON in Java. We receive a `,mdx(\"inlineCode\",{parentName:\"p\"},\"JsonNode\"),` from the\n`,mdx(\"inlineCode\",{parentName:\"p\"},\"ObjectMapper.readTree()\"),` method allowing us to access arbitrary JSON properties\nin the tree structure.`),mdx(\"p\",null,\"Note that when calling methods such as \",mdx(\"inlineCode\",{parentName:\"p\"},\"JsonNode.asInt()\"),` to coerce the\nunderlying value to an `,mdx(\"inlineCode\",{parentName:\"p\"},\"int\"),` other JSON values other than numbers such as\nbooleans and strings may be accepted. If the value cannot be coerced to an `,mdx(\"inlineCode\",{parentName:\"p\"},\"int\"),`\nthe default value of the type will be returned which would be 0 for ints.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` com.fasterxml.jackson.databind.JsonNode;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` com.fasterxml.jackson.databind.ObjectMapper;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.io.IOException;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.io.InputStream;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.URI;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.URISyntaxException;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.http.HttpClient;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.http.HttpRequest;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.http.HttpResponse;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.http.HttpResponse.BodyHandlers;\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"JavaExample\"),` {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"static\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"void\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"main\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"(String[] _args)\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"throws\"),` URISyntaxException, IOException, InterruptedException {\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"HttpClient\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"client\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` HttpClient.newHttpClient();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"HttpRequest\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"request\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` HttpRequest.newBuilder()\n                .uri(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"URI\"),\"(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"https://jsonplaceholder.typicode.com/todos/1\"'),`))\n                .GET()\n                .build();\n        HttpResponse\u003cInputStream\u003e response = client.send(request, BodyHandlers.ofInputStream());\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"ObjectMapper\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"mapper\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"ObjectMapper\"),`();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"JsonNode\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"data\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` mapper.readTree(response.body());\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"id\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),\" data.get(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"id\"'),`).asInt();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"userId\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),\" data.get(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"userId\"'),`).asInt();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"String\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"title\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),\" data.get(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"title\"'),`).asText();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"boolean\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"completed\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),\" data.get(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"completed\"'),`).asBoolean();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"JsonNode\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"doesNotExist\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),\" data.get(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"doesNotExist\"'),\"); \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// null at runtime!\"),`\n    }\n}\n`)),mdx(\"h3\",null,\"Go\"),mdx(\"p\",null,\"The empty interface \",mdx(\"inlineCode\",{parentName:\"p\"},\"interface{}\"),` in Go allows working with data of an unknown\ntype. If we use `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://pkg.go.dev/encoding/json#Unmarshal\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"json.Unmarshal()\"),`\non a pointer to a `,mdx(\"inlineCode\",{parentName:\"p\"},\"map[string]interface{}\"),` value we'll receive the deserialized\nJSON object according to the specified types:`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays\nmap[string]interface{}, for JSON objects\nnil for JSON null\n`)),mdx(\"p\",null,\"Note that numbers are always deserialized to \",mdx(\"inlineCode\",{parentName:\"p\"},\"float64\"),` when an interface value\nis used so an explicit type conversion to `,mdx(\"inlineCode\",{parentName:\"p\"},\"int\"),\" is needed if desired.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-go\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` (\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"encoding/json\"'),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"io\"'),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"net/http\"'),`\n)\n\nresponse, err := http.Get(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"https://jsonplaceholder.typicode.com/todos/1\"'),`)\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),\" err != \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"nil\"),` {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"panic\"),`(err)\n}\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"defer\"),` response.Body.Close()\n\nbody, err := io.ReadAll(response.Body)\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),\" err != \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"nil\"),` {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"panic\"),`(err)\n}\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),\" data \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"map\"),\"[\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"string\"),\"]\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"interface\"),`{}\nerr = json.Unmarshal(body, \u0026data)\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),\" err != \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"nil\"),` {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"panic\"),`(err)\n}\n\nid := data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"id\"'),\"].(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"float64\"),\")            \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// float64\"),`\nuserId := data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"userId\"'),\"].(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"float64\"),\")    \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// float64\"),`\ntitle := data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"title\"'),\"].(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"string\"),\")       \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// string\"),`\ncompleted := data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"completed\"'),\"].(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"bool\"),\") \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// bool\"),`\ndoesNotExist := data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"doesNotExist\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// interface{}, nil at runtime!\"),`\n`)),mdx(\"h2\",null,\"Typed deserialization\"),mdx(\"p\",null,`Now let's consider how to deserialize JSON into typed objects allowing our code\nto operate in a safer way and automatically catch mistakes such as a typo\naccessing wrong field names.`),mdx(\"h3\",null,\"TypeScript\"),mdx(\"p\",null,`An explicit type annotation gives a hint to the TypeScript compiler on the type\nwe want it to treat the object as. Now the compiler knows what fields exist and\nwhat types they should be it can catch errors on incorrect access (according to\nthe types it was told).`),mdx(\"p\",null,`Note that this is compile time only and does not change the runtime JavaScript\ncode once compiled with any extra validation or type conversions - the exact\nsame JavaScript object is still used which may error at runtime if typed\nincorrectly or subsequently mutated.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-typescript\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"interface\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"Todo\"),` {\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),\"userId\"),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"number\"),`;\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),\"id\"),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"number\"),`;\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),\"title\"),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"string\"),`;\n  `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),\"completed\"),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"boolean\"),`;\n}\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" response = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"await\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"fetch\"),\"(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"https://jsonplaceholder.typicode.com/todos/1\"'),`);\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-attr\"}),\"data\"),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"Todo\"),\" = \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"await\"),\" response.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"json\"),`();\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" id = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"id\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// number\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" userId = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"userId\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// number\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" title = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"title\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// string\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" completed = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"completed\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// boolean\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"const\"),\" doesNotExist = data.\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-property\"}),\"doesNotExist\"),\"; \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// compile error!\"),`\n`)),mdx(\"h3\",null,\"Python\"),mdx(\"p\",null,\"The \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://mypy.readthedocs.io/en/stable/typed_dict.html\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"TypedDict\")),` type\nallows us to perform a very similar type annotation. When using\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://mypy.readthedocs.io/en/stable/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"mypy\"),` to check static types we achieve\na similar level of protection at lint time.`),mdx(\"p\",null,`Note that this is lint time only and again does not affect the executed code at\nruntime.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-python\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` json\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` urllib.request\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"from\"),\" typing \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` TypedDict\n\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"Todo\"),\"(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_ inherited__\"}),\"TypedDict\"),`):\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"id\"),\": \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"int\"),`\n    userId: `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"int\"),`\n    title: `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"str\"),`\n    completed: `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"bool\"),`\n\n\nresponse = urllib.request.urlopen(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"https://jsonplaceholder.typicode.com/todos/1\"'),`)\ndata: Todo = json.loads(response.read().decode(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"utf-8\"'),\"))  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# Todo\"),`\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"id\"),\" = data[\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"id\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# int\"),`\nuser_id = data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"userId\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# int\"),`\ntitle = data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"title\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# str\"),`\ncompleted = data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"completed\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# bool\"),`\ndoes_not_exist = data[`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"doesNotExist\"'),\"]  \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"# typeddict-item error at lint time!\"),`\n`)),mdx(\"h3\",null,\"Java\"),mdx(\"p\",null,`The first step is to define a class to deserialize data into. Here we define a\nsimple `,mdx(\"inlineCode\",{parentName:\"p\"},\"Todo\"),` plain old Java object (POJO) with standard getters and setters.\nJackson automatically works with these types of classes out of the box by\nmatching the field names based on the method names. Jackson annotations can\ncustomise the deserialization behaviour such as `,mdx(\"inlineCode\",{parentName:\"p\"},\"@JsonProperty\"),` to remap field\nnames.`),mdx(\"p\",null,\"Note that this does change the runtime code. It creates new \",mdx(\"inlineCode\",{parentName:\"p\"},\"Todo\"),` objects\nrather than `,mdx(\"inlineCode\",{parentName:\"p\"},\"JsonNode\"),` objects and by default, Jackson object mappers fail on\nencountering unknown properties during deserialization.`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-java\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` com.fasterxml.jackson.databind.ObjectMapper;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.io.IOException;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.io.InputStream;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.URI;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.URISyntaxException;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.http.HttpClient;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.http.HttpRequest;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.http.HttpResponse;\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` java.net.http.HttpResponse.BodyHandlers;\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"JavaExample\"),` {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"static\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"void\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"main\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"(String[] _args)\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"throws\"),` URISyntaxException, IOException, InterruptedException {\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"HttpClient\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"client\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` HttpClient.newHttpClient();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"HttpRequest\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"request\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` HttpRequest.newBuilder()\n                .uri(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"URI\"),\"(\",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"https://jsonplaceholder.typicode.com/todos/1\"'),`))\n                .GET()\n                .build();\n        HttpResponse\u003cInputStream\u003e response = client.send(request, BodyHandlers.ofInputStream());\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"ObjectMapper\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"mapper\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"new\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"ObjectMapper\"),`();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"Todo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"todo\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` mapper.readValue(response.body(), Todo.class);\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"id\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` todo.getId();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"userId\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` todo.getUserId();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"String\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"title\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` todo.getTitle();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"boolean\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"completed\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),` todo.getCompleted();\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"JsonNode\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-variable\"}),\"doesNotExist\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-operator\"}),\"=\"),\" todo.getDoesNotExist(); \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// compile error!\"),`\n    }\n\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"private\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"static\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"final\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"class\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title class_\"}),\"Todo\"),` {\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"private\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),` id;\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"private\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),` userId;\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"private\"),` String title;\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"private\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"boolean\"),` completed;\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"getId\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"()\"),` {\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` id;\n        }\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"void\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"setId\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"(\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-type\"}),\"int\"),\" id)\"),` {\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"this\"),`.id = id;\n        }\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"getUserId\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"()\"),` {\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` userId;\n        }\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"void\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"setUserId\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"(\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-type\"}),\"int\"),\" userId)\"),` {\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"this\"),`.userId = userId;\n        }\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" String \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"getTitle\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"()\"),` {\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` title;\n        }\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"void\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"setTitle\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"(String title)\"),` {\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"this\"),`.title = title;\n        }\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"boolean\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"getCompleted\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"()\"),` {\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"return\"),` completed;\n        }\n\n        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"public\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"void\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-title function_\"}),\"setCompleted\"),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-params\"}),\"(\",mdx(\"span\",e({parentName:\"span\"},{className:\"hljs-type\"}),\"boolean\"),\" completed)\"),` {\n            `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"this\"),`.completed = completed;\n        }\n    }\n}\n`)),mdx(\"h3\",null,\"Go\"),mdx(\"p\",null,`Instead of deserializing into the empty interface we can define and deserialize\ninto a `,mdx(\"inlineCode\",{parentName:\"p\"},\"struct\"),\". The field names are matched to \",mdx(\"inlineCode\",{parentName:\"p\"},\"struct\"),` field names accepting\ncase-insensitive matches. Alternative field names may be used by adding extra\nmetadata in `,mdx(\"a\",e({parentName:\"p\"},{href:\"https://pkg.go.dev/encoding/json#Marshal\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"struct tags\"),` such as\n`,mdx(\"inlineCode\",{parentName:\"p\"},'Field int `json:\"myName\"`')),mdx(\"p\",null,`Note that similar to Java this does have an effect at runtime for example\nchoosing to deserialize numbers as ints rather than `,mdx(\"inlineCode\",{parentName:\"p\"},\"float64\"),\".\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"hljs language-go\"}),mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"import\"),` (\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"encoding/json\"'),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"io\"'),`\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"net/http\"'),`\n)\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"type\"),\" Todo \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"struct\"),` {\n    Id        `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),\"    \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'`json:\"id\"`'),`\n    UserId    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"int\"),\"    \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'`json:\"userId\"`'),`\n    Title     `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"string\"),\" \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'`json:\"title\"`'),`\n    Completed `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-type\"}),\"bool\"),\"   \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'`json:\"completed\"`'),`\n}\n\nresponse, err := http.Get(`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-string\"}),'\"https://jsonplaceholder.typicode.com/todos/1\"'),`)\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),\" err != \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"nil\"),` {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"panic\"),`(err)\n}\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"defer\"),` response.Body.Close()\n\nbody, err := io.ReadAll(response.Body)\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),\" err != \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"nil\"),` {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"panic\"),`(err)\n}\n\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"var\"),` data Todo\nerr = json.Unmarshal(body, \u0026data)\n`,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-keyword\"}),\"if\"),\" err != \",mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-literal\"}),\"nil\"),` {\n    `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-built_in\"}),\"panic\"),`(err)\n}\n\nid := data.Id                     `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// int\"),`\nuserId := data.UserId             `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// int\"),`\ntitle := data.Title               `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// string\"),`\ncompleted := data.Completed       `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// bool\"),`\ndoesNotExist := data.DoesNotExist `,mdx(\"span\",e({parentName:\"code\"},{className:\"hljs-comment\"}),\"// compile error!\"),`\n`)),mdx(\"h2\",null,\"Data constraints\"),mdx(\"p\",null,`Going further than simply parsing we may want to enforce data constraints\nrelevant to the objects in our data model.`),mdx(\"p\",null,\"Some of these may be inherent to the deserialization itself such as:\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Treat missing or null values for array fields as an empty array\"),mdx(\"li\",{parentName:\"ul\"},\"Remove null elements inside arrays\"),mdx(\"li\",{parentName:\"ul\"},\"Fail on extra fields sent that we do not recognise\")),mdx(\"p\",null,`This category of data constraint can often be tuned for example with Jackson's\n`,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/FasterXML/jackson-databind/wiki/Deserialization-Features\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"DeserializationFeature\"),\".\"),mdx(\"p\",null,`Others may be relevant to business logic or necessary for the object as a whole\nto make sense for example invariants between fields:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Max length of string for a title\"),mdx(\"li\",{parentName:\"ul\"},\"Non-negative integer value for a page size\"),mdx(\"li\",{parentName:\"ul\"},\"Value matches expected format like a book ISBN number\")),mdx(\"p\",null,`For TypeScript and Python, these will obviously require extra code changes at\nruntime and will make the deserialization perform closer to the given Java and\nGo examples. Ideas to explore in this direction are:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"Typescript\",mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://zod.dev/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"zod\"))))),mdx(\"li\",{parentName:\"ul\"},\"Python\",mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.python.org/3/library/dataclasses.html\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"dataclasses\"))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.pydantic.dev/latest/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"pydantic\"))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.attrs.org/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"attrs\")),\" and \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://catt.rs/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),mdx(\"inlineCode\",{parentName:\"a\"},\"cattrs\"))))),mdx(\"li\",{parentName:\"ul\"},\"Java\",mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://beanvalidation.org/2.0-jsr380/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"JSR 380\"),` and the\n`,mdx(\"inlineCode\",{parentName:\"li\"},\"jakarta.validation.constraints\"),\" annotations\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://immutables.github.io/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"Immutables\"),\" with precondition check methods\"))),mdx(\"li\",{parentName:\"ul\"},\"Go\",mdx(\"ul\",{parentName:\"li\"},mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://github.com/go-playground/validator\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"go-playground/validator\"))))),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://json-schema.org/\",target:\"_blank\",rel:\"nofollow noopener noreferrer\"}),\"JSON Schema\"),` also exists as a standard for defining a\nschema for JSON data with validator implementations for all of the popular\nprogramming languages.`),mdx(\"h3\",null,\"Conclusion\"),mdx(\"p\",null,`One of the main purposes of JSON is for interoperability between different\nsoftware boundaries. It's interesting to take a fundamental task such as\ndeserializing JSON and compare side by side how different languages and their\nlibraries approach it.`),mdx(\"p\",null,`Notably, Java stands out as requiring an external library to perform basic\nparsing and potentially even further libraries for cutting down boilerplate code\nthrough codegen of standard getter/setters. I'm personally a fan of the mix of\nconciseness and out of the box safety provided by Go in this case without the\nneed for a lot of work to setup additional tools.`))}MDXContent.isMDXComponent=!0;\n","scope":{}}}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"deserializing-json"},"buildId":"GsZxPt-1H7wdCO3DxNgQU","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>